<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Generator K3S BEJI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap');
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
            color: #334e68;
            position: relative;
            min-height: 100vh;
        }

        /* --- UI COMPONENTS (3D & Glass) --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15), inset 0 0 0 1px rgba(255,255,255,0.5);
        }

        /* 3D Button Effect */
        .btn-3d {
            transition: all 0.1s;
            box-shadow: 0 4px 0px 0px rgba(0,0,0,0.1);
            transform: translateY(0);
        }
        .btn-3d:active {
            transform: translateY(4px);
            box-shadow: 0 0px 0px 0px rgba(0,0,0,0.1);
        }

        /* Logo Animation */
        @keyframes spin-slow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 6s linear infinite;
        }
        .animate-spin-reverse {
            animation: spin-slow 8s linear infinite reverse;
        }

        /* --- INPUT STYLES --- */
        .input-frame {
            background-color: white;
            padding: 1.5rem;
            border-radius: 1.5rem;
            border: 2px solid #e2e8f0;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
            height: 100%;
            transition: border-color 0.3s, transform 0.3s;
        }
        .input-frame:hover { border-color: #bfdbfe; transform: translateY(-2px); }

        .form-label {
            display: block;
            font-size: 0.85rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #475569;
            margin-bottom: 0.75rem;
            margin-left: 0.25rem;
        }

        .input-container { position: relative; width: 100%; }
        .input-icon {
            position: absolute;
            top: 0; bottom: 0; left: 0;
            display: flex; align-items: center; padding-left: 1.25rem;
            pointer-events: none; color: #94a3b8; font-size: 1.25rem;
        }
        .textarea-icon { top: 1.25rem; bottom: auto; }

        .styled-input {
            width: 100%;
            padding-left: 3.5rem; padding-right: 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            background-color: #f8fafc;
            font-size: 1rem;
            font-weight: 500;
            color: #334155;
            transition: all 0.2s;
            outline: none;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.03);
        }
        .styled-input:focus {
            border-color: #3b82f6;
            background-color: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        input.styled-input { height: 3.5rem; }
        textarea.styled-input { min-height: 100px; padding-top: 1rem; padding-bottom: 1rem; resize: vertical; }

        /* --- CARD SELECTION (3D Style) --- */
        .selection-card {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            background-color: white;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            box-shadow: 0 4px 0 #cbd5e1;
            height: 100%;
        }
        .selection-card:hover { transform: translateY(-3px); box-shadow: 0 8px 0 #94a3b8; }
        .selection-card:active { transform: translateY(2px); box-shadow: 0 2px 0 #94a3b8; }

        input[type="radio"]:checked + .selection-card {
            border-color: #3b82f6; 
            background-color: #eff6ff; 
            box-shadow: 0 4px 0 #2563eb;
        }
        
        /* Check Badge */
        .check-badge { position: absolute; top: 6px; right: 6px; color: #2563eb; font-size: 14px; opacity: 0; transform: scale(0); transition: all 0.2s; }
        input[type="radio"]:checked + .selection-card .check-badge { opacity: 1; transform: scale(1); }
        
        .card-icon { font-size: 2rem; margin-bottom: 0.5rem; transition: transform 0.2s; filter: grayscale(100%); opacity: 0.6; }
        .card-text { font-size: 0.7rem; color: #64748b; font-weight: 600; text-transform: uppercase; transition: color 0.2s; }
        
        input[type="radio"]:checked + .selection-card .card-icon { filter: grayscale(0%); opacity: 1; transform: scale(1.1); }
        input[type="radio"]:checked + .selection-card .card-text { color: #1d4ed8; font-weight: 800; }
        
        /* Game Mode Grid Cards */
        .game-card {
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
            padding: 1.25rem 0.5rem; gap: 0.75rem; height: 100%;
            border: 2px solid #e2e8f0; border-radius: 1.25rem; background: white; cursor: pointer;
            transition: all 0.2s; box-shadow: 0 4px 0 #cbd5e1;
        }
        .game-card:hover { border-color: #bfdbfe; transform: translateY(-3px); box-shadow: 0 8px 0 #94a3b8; }
        .game-card:active { transform: translateY(2px); box-shadow: 0 2px 0 #94a3b8; }
        
        input[type="radio"]:checked + .game-card { 
            border-color: #3b82f6; background: #eff6ff; box-shadow: 0 4px 0 #2563eb; 
        }

        /* --- UTILS --- */
        .modal-overlay { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(8px); display: flex; align-items: center; justify-content: center; z-index: 5000; }
        .loader { width: 48px; height: 48px; border: 5px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .code-preview { font-family: 'Consolas', 'Monaco', monospace; font-size: 12px; line-height: 1.5; }
        
        /* Custom Scrollbar for Game List */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Section: Login -->
    <div id="login-section" class="flex items-center justify-center h-screen relative z-10">
        <div class="glass-panel p-10 rounded-3xl shadow-2xl w-96 transform transition-all hover:scale-[1.01]">
            <div class="text-center mb-8">
                <!-- Logo: Circular Line Animation -->
                <div class="relative inline-flex justify-center items-center mb-6">
                    <!-- Outer rotating ring -->
                    <div class="absolute inset-0 rounded-full border-[3px] border-transparent border-t-blue-500 border-r-indigo-400/50 animate-spin-slow"></div>
                    <!-- Inner rotating ring (reverse) -->
                    <div class="absolute inset-3 rounded-full border-[3px] border-transparent border-b-pink-500 border-l-purple-400/50 animate-spin-reverse"></div>
                    <div class="p-4 relative z-10">
                        <img src="https://lh3.googleusercontent.com/d/1UXDrhKgeSjfFks_oXIMOVYgxFG_Bh1nm" alt="Logo K3S" class="h-28 md:h-36 w-auto object-contain drop-shadow-xl">
                    </div>
                </div>
                <h1 class="text-2xl font-black text-slate-800 tracking-tight drop-shadow-sm">GAME CREATOR</h1>
                <div class="h-1.5 w-24 bg-gradient-to-r from-blue-400 to-indigo-500 mx-auto rounded-full mt-3 mb-3"></div>
                <p class="text-indigo-600 font-bold tracking-[0.2em] text-sm">BEJI PASURUAN</p>
            </div>
            
            <div class="space-y-5">
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-indigo-400 group-focus-within:text-indigo-600"><i class="fa-regular fa-user text-lg"></i></div>
                    <input type="text" id="username" placeholder="Username" class="w-full pl-12 pr-4 h-14 border-2 border-slate-200 rounded-xl bg-white focus:border-indigo-500 outline-none font-medium text-slate-700 shadow-sm transition-all">
                </div>
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-pink-400 group-focus-within:text-pink-600"><i class="fa-solid fa-lock text-lg"></i></div>
                    <input type="password" id="password" placeholder="Password" class="w-full pl-12 pr-4 h-14 border-2 border-slate-200 rounded-xl bg-white focus:border-pink-500 outline-none font-medium text-slate-700 shadow-sm transition-all">
                </div>

                <button onclick="handleLogin()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-4 rounded-xl font-bold hover:from-blue-700 hover:to-indigo-700 transition-all shadow-lg btn-3d flex items-center justify-center gap-2 text-lg">
                    MASUK SISTEM <i class="fa-solid fa-arrow-right-to-bracket"></i>
                </button>
            </div>
            <p id="login-error" class="text-red-500 text-xs mt-4 text-center hidden font-medium bg-red-50 py-2 rounded-lg border border-red-100">
                <i class="fa-solid fa-circle-exclamation mr-1"></i> Username atau Password salah!
            </p>
        </div>
    </div>

    <!-- Section: Admin Dashboard -->
    <div id="admin-section" class="hidden min-h-screen p-4 md:p-8 bg-slate-100">
        <div class="max-w-6xl mx-auto">
            <div class="flex justify-between items-center mb-8 bg-white p-4 rounded-2xl shadow-sm border border-slate-200">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600"><i class="fa-solid fa-users-gear"></i></div>
                    <h2 class="text-2xl font-black text-slate-800">ADMIN PANEL</h2>
                </div>
                <button onclick="logout()" class="bg-red-500 text-white px-5 py-2.5 rounded-xl font-bold text-sm hover:bg-red-600 shadow-lg shadow-red-200 transition btn-3d"><i class="fa-solid fa-right-from-bracket mr-2"></i> Logout</button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- User Management -->
                <div class="bg-white p-6 rounded-3xl shadow-xl border border-slate-200">
                    <div class="flex items-center gap-3 mb-6 border-b pb-4">
                        <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600"><i class="fa-solid fa-user-shield"></i></div>
                        <h3 class="text-lg font-bold text-slate-700">Manajemen User</h3>
                    </div>
                    
                    <div class="bg-slate-50 p-4 rounded-xl mb-6 border border-slate-200">
                        <label class="text-xs font-bold text-slate-500 mb-2 block uppercase">Tambah User Baru</label>
                        <div class="flex gap-2">
                            <input type="text" id="new-user" placeholder="Username" class="flex-1 border-2 border-slate-200 p-3 rounded-xl text-sm outline-none focus:border-green-500 transition">
                            <input type="text" id="new-pass" placeholder="Password" class="flex-1 border-2 border-slate-200 p-3 rounded-xl text-sm outline-none focus:border-green-500 transition">
                            <button onclick="addUser()" class="bg-green-500 text-white px-4 rounded-xl font-bold hover:bg-green-600 shadow-md btn-3d"><i class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>

                    <div class="overflow-hidden rounded-xl border border-slate-200">
                        <table class="w-full text-sm text-left">
                            <thead class="bg-slate-100 text-slate-600 uppercase font-bold text-xs">
                                <tr>
                                    <th class="px-4 py-3">Username</th>
                                    <th class="px-4 py-3">Role</th>
                                    <th class="px-4 py-3 text-right">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="user-table-body" class="divide-y divide-slate-100 bg-white"></tbody>
                        </table>
                    </div>
                </div>

                <!-- API Key Management (HIDDEN AS PER REQUEST) -->
                <div class="hidden bg-white p-6 rounded-3xl shadow-xl border border-slate-200 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-yellow-100 rounded-full blur-3xl opacity-50 -mr-10 -mt-10 pointer-events-none"></div>
                    <div class="flex items-center gap-3 mb-6 border-b pb-4 relative z-10">
                        <div class="w-8 h-8 rounded-full bg-yellow-100 flex items-center justify-center text-yellow-600"><i class="fa-solid fa-key"></i></div>
                        <h3 class="text-lg font-bold text-slate-700">Konfigurasi API AI (Gemini)</h3>
                    </div>
                    <div class="space-y-5 relative z-10">
                        <p class="text-sm text-slate-500 italic">API Integration has been disabled.</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 text-center pb-8">
                <button onclick="goToGenerator()" class="bg-indigo-600 text-white px-10 py-4 rounded-2xl font-black text-lg shadow-xl shadow-indigo-200 hover:bg-indigo-700 transition btn-3d transform hover:scale-[1.02]">
                    BUKA GENERATOR GAME <i class="fa-solid fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Section: Generator Form -->
    <div id="generator-section" class="hidden min-h-screen p-4 md:p-8">
        <div class="max-w-[90rem] mx-auto glass-panel rounded-[2.5rem] shadow-2xl p-6 md:p-10 relative overflow-hidden">
            <!-- Decorative blobs -->
            <div class="absolute -top-20 -right-20 w-64 h-64 bg-purple-200 rounded-full blur-3xl opacity-30 pointer-events-none"></div>
            <div class="absolute -bottom-20 -left-20 w-64 h-64 bg-blue-200 rounded-full blur-3xl opacity-30 pointer-events-none"></div>

            <!-- HEADER -->
            <div class="flex justify-between items-center mb-8 relative z-10">
                <div class="flex items-center gap-6">
                    <div class="relative flex items-center justify-center p-2">
                        <div class="absolute inset-0 rounded-full border-2 border-transparent border-t-blue-500/30 animate-spin-slow"></div>
                        <img src="https://lh3.googleusercontent.com/d/1UXDrhKgeSjfFks_oXIMOVYgxFG_Bh1nm" alt="Logo K3S" class="h-20 w-auto relative z-10 drop-shadow-md">
                    </div>
                    <div class="text-left">
                        <h2 class="text-3xl font-black text-slate-800 leading-none drop-shadow-sm">K3S BEJI <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600">CREATOR</span></h2>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="bg-slate-800 text-white text-[10px] font-bold px-2 py-0.5 rounded shadow-md">V5.0 PROMPT</span>
                            <p class="text-slate-500 font-bold text-xs tracking-widest uppercase">GAME PROMPT GENERATOR</p>
                        </div>
                    </div>
                </div>
                <div id="admin-btn-container" class="hidden">
                    <button onclick="showAdmin()" class="bg-white text-slate-600 px-5 py-2.5 rounded-xl font-bold text-sm hover:bg-slate-50 border border-slate-200 shadow-sm transition btn-3d">
                        <i class="fa-solid fa-gear mr-2 text-slate-400"></i> Settings
                    </button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 xl:grid-cols-2 gap-8 relative z-10">
                <!-- Kolom Kiri -->
                <div class="input-frame">
                    <div class="frame-title mb-6 border-b pb-4 flex items-center gap-3">
                        <div class="bg-gradient-to-br from-indigo-500 to-purple-600 text-white w-10 h-10 flex items-center justify-center rounded-xl shadow-lg text-lg"><i class="fa-solid fa-fingerprint"></i></div> 
                        <h3 class="text-xl font-bold text-slate-800">Identitas & Materi</h3>
                    </div>
                    
                    <div class="mb-5">
                        <label class="form-label">Nama Aplikasi</label>
                        <div class="input-container">
                             <div class="input-icon text-purple-400"><i class="fa-solid fa-gamepad"></i></div>
                             <input type="text" id="gen-app-name" placeholder="Contoh: Petualangan Matematika Seru" class="styled-input">
                        </div>
                    </div>
                    
                    <div class="mb-5">
                        <label class="form-label">Mata Pelajaran</label>
                        <div class="grid grid-cols-3 md:grid-cols-4 gap-3">
                            <label class="relative"><input type="radio" name="subject_select" value="Pendidikan Agama" class="absolute opacity-0 w-0 h-0" checked><div class="selection-card"><div class="check-badge"><i class="fa-solid fa-circle-check"></i></div><span class="card-icon">üïå</span><span class="card-text">Agama</span></div></label>
                            <label class="relative"><input type="radio" name="subject_select" value="PPKn" class="absolute opacity-0 w-0 h-0"><div class="selection-card"><div class="check-badge"><i class="fa-solid fa-circle-check"></i></div><span class="card-icon">üáÆüá©</span><span class="card-text">PPKn</span></div></label>
                            <label class="relative"><input type="radio" name="subject_select" value="Bahasa Indonesia" class="absolute opacity-0 w-0 h-0"><div class="selection-card"><div class="check-badge"><i class="fa-solid fa-circle-check"></i></div><span class="card-icon">üìö</span><span class="card-text">B. Indo</span></div></label>
                            <label class="relative"><input type="radio" name="subject_select" value="Matematika" class="absolute opacity-0 w-0 h-0"><div class="selection-card"><div class="check-badge"><i class="fa-solid fa-circle-check"></i></div><span class="card-icon">üìê</span><span class="card-text">MTK</span></div></label>
                            <label class="relative"><input type="radio" name="subject_select" value="IPA" class="absolute opacity-0 w-0 h-0"><div class="selection-card"><div class="check-badge"><i class="fa-solid fa-circle-check"></i></div><span class="card-icon">üî¨</span><span class="card-text">IPA</span></div></label>
                            <label class="relative"><input type="radio" name="subject_select" value="IPS" class="absolute opacity-0 w-0 h-0"><div class="selection-card"><div class="check-badge"><i class="fa-solid fa-circle-check"></i></div><span class="card-icon">üåç</span><span class="card-text">IPS</span></div></label>
                            <label class="relative"><input type="radio" name="subject_select" value="PJOK" class="absolute opacity-0 w-0 h-0"><div class="selection-card"><div class="check-badge"><i class="fa-solid fa-circle-check"></i></div><span class="card-icon">‚öΩ</span><span class="card-text">PJOK</span></div></label>
                            <label class="relative"><input type="radio" name="subject_select" value="Seni Budaya" class="absolute opacity-0 w-0 h-0"><div class="selection-card"><div class="check-badge"><i class="fa-solid fa-circle-check"></i></div><span class="card-icon">üé®</span><span class="card-text">Seni</span></div></label>
                            <label class="relative"><input type="radio" name="subject_select" value="Bahasa Inggris" class="absolute opacity-0 w-0 h-0"><div class="selection-card"><div class="check-badge"><i class="fa-solid fa-circle-check"></i></div><span class="card-icon">üÖ∞Ô∏è</span><span class="card-text">B. Inggris</span></div></label>
                        </div>
                    </div>

                    <div class="mb-5">
                        <label class="form-label">Kelas</label>
                        <div class="grid grid-cols-6 gap-2">
                            <label class="cursor-pointer relative"><input type="radio" name="grade" value="1" class="peer sr-only"><div class="peer-checked:bg-gradient-to-b peer-checked:from-blue-500 peer-checked:to-blue-600 peer-checked:text-white peer-checked:shadow-lg peer-checked:border-blue-600 bg-white border-2 border-slate-200 text-slate-500 rounded-xl py-2 text-center font-black text-lg transition-all hover:border-blue-300">1</div></label>
                            <label class="cursor-pointer relative"><input type="radio" name="grade" value="2" class="peer sr-only"><div class="peer-checked:bg-gradient-to-b peer-checked:from-blue-500 peer-checked:to-blue-600 peer-checked:text-white peer-checked:shadow-lg peer-checked:border-blue-600 bg-white border-2 border-slate-200 text-slate-500 rounded-xl py-2 text-center font-black text-lg transition-all hover:border-blue-300">2</div></label>
                            <label class="cursor-pointer relative"><input type="radio" name="grade" value="3" class="peer sr-only"><div class="peer-checked:bg-gradient-to-b peer-checked:from-blue-500 peer-checked:to-blue-600 peer-checked:text-white peer-checked:shadow-lg peer-checked:border-blue-600 bg-white border-2 border-slate-200 text-slate-500 rounded-xl py-2 text-center font-black text-lg transition-all hover:border-blue-300">3</div></label>
                            <label class="cursor-pointer relative"><input type="radio" name="grade" value="4" class="peer sr-only"><div class="peer-checked:bg-gradient-to-b peer-checked:from-blue-500 peer-checked:to-blue-600 peer-checked:text-white peer-checked:shadow-lg peer-checked:border-blue-600 bg-white border-2 border-slate-200 text-slate-500 rounded-xl py-2 text-center font-black text-lg transition-all hover:border-blue-300">4</div></label>
                            <label class="cursor-pointer relative"><input type="radio" name="grade" value="5" class="peer sr-only"><div class="peer-checked:bg-gradient-to-b peer-checked:from-blue-500 peer-checked:to-blue-600 peer-checked:text-white peer-checked:shadow-lg peer-checked:border-blue-600 bg-white border-2 border-slate-200 text-slate-500 rounded-xl py-2 text-center font-black text-lg transition-all hover:border-blue-300">5</div></label>
                            <label class="cursor-pointer relative"><input type="radio" name="grade" value="6" class="peer sr-only" checked><div class="peer-checked:bg-gradient-to-b peer-checked:from-blue-500 peer-checked:to-blue-600 peer-checked:text-white peer-checked:shadow-lg peer-checked:border-blue-600 bg-white border-2 border-slate-200 text-slate-500 rounded-xl py-2 text-center font-black text-lg transition-all hover:border-blue-300">6</div></label>
                        </div>
                    </div>

                    <div class="mb-5">
                        <label class="form-label">Tujuan Pembelajaran</label>
                        <div class="input-container">
                             <div class="input-icon textarea-icon text-red-400"><i class="fa-solid fa-bullseye"></i></div>
                             <textarea id="gen-objective" class="styled-input h-20" placeholder="Siswa dapat memahami..."></textarea>
                        </div>
                    </div>

                    <div class="mb-5">
                        <label class="form-label">Topik Materi</label>
                        <div class="input-container">
                             <div class="input-icon textarea-icon text-yellow-500"><i class="fa-solid fa-lightbulb"></i></div>
                             <textarea id="gen-material" class="styled-input h-20" placeholder="Rincian materi soal..."></textarea>
                        </div>
                    </div>

                    <!-- Level Kognitif Selection -->
                    <div class="mb-5">
                        <label class="form-label">Level Kognitif Soal</label>
                        <div class="grid grid-cols-2 gap-3">
                            <label class="relative cursor-pointer group">
                                <input type="radio" name="cog_level" value="LOTS" class="peer sr-only">
                                <div class="selection-card p-3 flex flex-col items-center justify-center text-center">
                                    <div class="check-badge"><i class="fa-solid fa-circle-check"></i></div>
                                    <span class="text-2xl mb-1">üå±</span>
                                    <span class="font-bold text-xs text-slate-600">LOTS</span>
                                    <span class="text-[10px] text-slate-400 font-medium mt-1">Menghafal & Memahami</span>
                                </div>
                            </label>
                            <label class="relative cursor-pointer group">
                                <input type="radio" name="cog_level" value="MOTS" class="peer sr-only" checked>
                                <div class="selection-card p-3 flex flex-col items-center justify-center text-center">
                                    <div class="check-badge"><i class="fa-solid fa-circle-check"></i></div>
                                    <span class="text-2xl mb-1">üåø</span>
                                    <span class="font-bold text-xs text-slate-600">MOTS</span>
                                    <span class="text-[10px] text-slate-400 font-medium mt-1">Menerapkan & Aplikasi</span>
                                </div>
                            </label>
                            <label class="relative cursor-pointer group">
                                <input type="radio" name="cog_level" value="HOTS" class="peer sr-only">
                                <div class="selection-card p-3 flex flex-col items-center justify-center text-center">
                                    <div class="check-badge"><i class="fa-solid fa-circle-check"></i></div>
                                    <span class="text-2xl mb-1">üå≥</span>
                                    <span class="font-bold text-xs text-slate-600">HOTS</span>
                                    <span class="text-[10px] text-slate-400 font-medium mt-1">Analisis, Evaluasi, Kreasi</span>
                                </div>
                            </label>
                            <label class="relative cursor-pointer group">
                                <input type="radio" name="cog_level" value="LITERASI" class="peer sr-only">
                                <div class="selection-card p-3 flex flex-col items-center justify-center text-center">
                                    <div class="check-badge"><i class="fa-solid fa-circle-check"></i></div>
                                    <span class="text-2xl mb-1">üìñ</span>
                                    <span class="font-bold text-xs text-slate-600">LITERASI</span>
                                    <span class="text-[10px] text-slate-400 font-medium mt-1">Bacaan & Konteks</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="mb-2">
                        <label class="form-label">Footer Game</label>
                        <div class="input-container">
                             <div class="input-icon text-slate-400"><i class="fa-regular fa-copyright"></i></div>
                             <input type="text" id="gen-footer" value="@K3S Beji" class="styled-input">
                        </div>
                    </div>
                </div>

                <!-- Kolom Kanan -->
                <div class="input-frame">
                    <div class="frame-title mb-6 border-b pb-4 flex items-center gap-3">
                        <div class="bg-gradient-to-br from-orange-400 to-red-500 text-white w-10 h-10 flex items-center justify-center rounded-xl shadow-lg text-lg"><i class="fa-solid fa-sliders"></i></div>
                        <h3 class="text-xl font-bold text-slate-800">Konfigurasi Game</h3>
                    </div>

                    <!-- 10 Game Templates Grid 2x2 Style -->
                    <div class="mb-5">
                         <label class="form-label">Template Game (Pilih Salah Satu)</label>
                         <div class="h-80 overflow-y-auto custom-scroll pr-2 grid grid-cols-2 gap-3">
                             <!-- Cards -->
                             <label class="relative cursor-pointer group">
                                 <input type="radio" name="game_model" value="adventure" class="peer sr-only" checked>
                                 <div class="game-card">
                                     <div class="text-4xl">üè∞</div>
                                     <div>
                                        <div class="font-black text-slate-700 text-sm mb-1">PETUALANGAN RPG</div>
                                        <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Boss fight & Leveling</div>
                                     </div>
                                 </div>
                             </label>
                             
                             <label class="relative cursor-pointer group">
                                <input type="radio" name="game_model" value="racing" class="peer sr-only">
                                <div class="game-card">
                                    <div class="text-4xl">üèéÔ∏è</div>
                                    <div>
                                       <div class="font-black text-slate-700 text-sm mb-1">BALAP MOBIL</div>
                                       <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Speed & Nitro</div>
                                    </div>
                                </div>
                            </label>

                            <label class="relative cursor-pointer group">
                                <input type="radio" name="game_model" value="board" class="peer sr-only">
                                <div class="game-card">
                                    <div class="text-4xl">üé≤</div>
                                    <div>
                                       <div class="font-black text-slate-700 text-sm mb-1">PAPAN JALAN</div>
                                       <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Ular Tangga Style</div>
                                    </div>
                                </div>
                            </label>

                            <label class="relative cursor-pointer group">
                                <input type="radio" name="game_model" value="quizshow" class="peer sr-only">
                                <div class="game-card">
                                    <div class="text-4xl">üéôÔ∏è</div>
                                    <div>
                                       <div class="font-black text-slate-700 text-sm mb-1">CERDAS CERMAT</div>
                                       <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">TV Show & Buzzer</div>
                                    </div>
                                </div>
                            </label>

                            <label class="relative cursor-pointer group">
                                <input type="radio" name="game_model" value="memory" class="peer sr-only">
                                <div class="game-card">
                                    <div class="text-4xl">üß©</div>
                                    <div>
                                       <div class="font-black text-slate-700 text-sm mb-1">KARTU MEMORI</div>
                                       <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Cocokkan Pasangan</div>
                                    </div>
                                </div>
                            </label>

                             <label class="relative cursor-pointer group">
                                <input type="radio" name="game_model" value="balloon" class="peer sr-only">
                                <div class="game-card">
                                    <div class="text-4xl">üéà</div>
                                    <div>
                                       <div class="font-black text-slate-700 text-sm mb-1">PECAH BALON</div>
                                       <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Refleks Cepat</div>
                                    </div>
                                </div>
                            </label>

                            <label class="relative cursor-pointer group">
                                <input type="radio" name="game_model" value="wordsearch" class="peer sr-only">
                                <div class="game-card">
                                    <div class="text-4xl">üî†</div>
                                    <div>
                                       <div class="font-black text-slate-700 text-sm mb-1">CARI KATA</div>
                                       <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Puzzle Vocabulary</div>
                                    </div>
                                </div>
                            </label>

                             <label class="relative cursor-pointer group">
                                <input type="radio" name="game_model" value="shooter" class="peer sr-only">
                                <div class="game-card">
                                    <div class="text-4xl">üöÄ</div>
                                    <div>
                                       <div class="font-black text-slate-700 text-sm mb-1">MISI ANGKASA</div>
                                       <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Tembak Jawaban</div>
                                    </div>
                                </div>
                            </label>

                            <label class="relative cursor-pointer group">
                                <input type="radio" name="game_model" value="farming" class="peer sr-only">
                                <div class="game-card">
                                    <div class="text-4xl">üåª</div>
                                    <div>
                                       <div class="font-black text-slate-700 text-sm mb-1">KEBUN PINTAR</div>
                                       <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Tumbuh Tanaman</div>
                                    </div>
                                </div>
                            </label>

                            <label class="relative cursor-pointer group">
                                <input type="radio" name="game_model" value="mystery" class="peer sr-only">
                                <div class="game-card">
                                    <div class="text-4xl">üïµÔ∏è</div>
                                    <div>
                                       <div class="font-black text-slate-700 text-sm mb-1">DETEKTIF</div>
                                       <div class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Pecahkan Kasus</div>
                                    </div>
                                </div>
                            </label>
                         </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-5">
                        <div class="flex flex-col gap-4">
                            <div>
                                <label class="form-label">Mode Perangkat</label>
                                <div class="flex flex-col gap-2">
                                    <label class="cursor-pointer">
                                        <input type="radio" name="device_mode" value="ifp" class="peer sr-only" checked>
                                        <div class="px-3 py-2 rounded-xl border border-slate-200 bg-white text-xs font-bold text-slate-500 peer-checked:bg-indigo-50 peer-checked:text-indigo-600 peer-checked:border-indigo-400 transition hover:bg-slate-50 flex items-center gap-2">
                                            <i class="fa-solid fa-tv"></i> IFP (Split)
                                        </div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="device_mode" value="mobile" class="peer sr-only">
                                        <div class="px-3 py-2 rounded-xl border border-slate-200 bg-white text-xs font-bold text-slate-500 peer-checked:bg-indigo-50 peer-checked:text-indigo-600 peer-checked:border-indigo-400 transition hover:bg-slate-50 flex items-center gap-2">
                                            <i class="fa-solid fa-mobile-screen"></i> Seluler
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="form-label">Waktu (Detik)</label>
                                <div class="input-container">
                                    <div class="input-icon text-slate-400 text-sm"><i class="fa-solid fa-stopwatch"></i></div>
                                    <input type="number" id="gen-timer" value="10" class="styled-input" style="height: 3rem; font-size: 0.9rem;">
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <label class="form-label">Orientasi</label>
                            <div class="flex flex-col gap-2">
                                <label class="cursor-pointer">
                                    <input type="radio" name="orientation" value="landscape" class="peer sr-only" checked>
                                    <div class="px-3 py-2 rounded-xl border border-slate-200 bg-white text-xs font-bold text-slate-500 peer-checked:bg-blue-50 peer-checked:text-blue-600 peer-checked:border-blue-400 transition hover:bg-slate-50 flex items-center gap-2">
                                        <i class="fa-regular fa-image"></i> Landscape
                                    </div>
                                </label>
                                <label class="cursor-pointer">
                                    <input type="radio" name="orientation" value="portrait" class="peer sr-only">
                                    <div class="px-3 py-2 rounded-xl border border-slate-200 bg-white text-xs font-bold text-slate-500 peer-checked:bg-blue-50 peer-checked:text-blue-600 peer-checked:border-blue-400 transition hover:bg-slate-50 flex items-center gap-2">
                                        <i class="fa-solid fa-file-image"></i> Portrait
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="mb-5">
                        <label class="form-label">Tampilan Skor</label>
                        <div class="flex gap-4 p-3 bg-slate-50 rounded-xl border border-slate-200">
                             <label class="flex items-center gap-2 cursor-pointer hover:text-blue-600 transition">
                                <input type="checkbox" id="conf-score-point" class="w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500" checked>
                                <span class="text-xs font-bold text-slate-600 flex items-center gap-1"><i class="fa-solid fa-trophy text-yellow-500"></i> Poin</span>
                             </label>
                             <label class="flex items-center gap-2 cursor-pointer hover:text-blue-600 transition">
                                <input type="checkbox" id="conf-score-bar" class="w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500" checked>
                                <span class="text-xs font-bold text-slate-600 flex items-center gap-1"><i class="fa-solid fa-bars-progress text-green-500"></i> Progress Bar</span>
                             </label>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 mb-2">
                        <div>
                            <label class="form-label">Pemain</label>
                            <div class="input-container">
                                <div class="input-icon text-slate-400"><i class="fa-solid fa-users"></i></div>
                                <input type="number" id="gen-players" value="2" min="1" max="6" class="styled-input">
                            </div>
                        </div>
                        <div>
                            <label class="form-label">Jml Soal</label>
                            <div class="input-container">
                                <div class="input-icon text-slate-400"><i class="fa-solid fa-list-ol"></i></div>
                                <input type="number" id="gen-count" value="10" class="styled-input">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4 flex items-center justify-between bg-pink-50 p-3 rounded-xl border border-pink-100">
                        <div class="flex items-center gap-2 text-pink-600 font-bold text-xs">
                            <i class="fa-solid fa-volume-high"></i> Suara Pembaca Soal
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="audio-toggle" class="sr-only peer">
                            <div class="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-pink-500"></div>
                        </label>
                    </div>

                </div>
            </div>

            <!-- Single Generate Button -->
            <div class="mt-8 pt-6 border-t border-gray-100">
                <button onclick="startGeneration()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-700 text-white py-5 rounded-2xl font-black text-xl md:text-2xl hover:from-blue-700 hover:to-indigo-800 shadow-xl shadow-blue-200 transition-all btn-3d flex items-center justify-center gap-3 group transform hover:scale-[1.01]">
                    <span class="bg-white/20 p-2.5 rounded-full"><i class="fa-solid fa-wand-magic-sparkles group-hover:rotate-12 transition"></i></span>
                    <div class="text-left leading-tight">
                        <div>GENERATE SPECIFICATION JSON</div>
                        <div class="text-xs font-medium opacity-80 tracking-wide uppercase">Create Game Spec</div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Section: Loading Modal -->
    <div id="loading-modal" class="hidden modal-overlay z-[6000]">
        <div class="bg-white p-10 rounded-[2.5rem] shadow-2xl flex flex-col items-center max-w-sm text-center border-4 border-blue-100 relative overflow-hidden">
            <div class="absolute inset-0 bg-blue-50/50 z-0"></div>
            <div class="relative z-10">
                <span class="loader mb-6 border-blue-500 border-b-transparent"></span>
                <h3 class="text-2xl font-black text-slate-800 mb-2">Memproses...</h3>
                <p class="text-sm text-slate-500 leading-relaxed font-medium">Menyusun spesifikasi game Anda.</p>
            </div>
        </div>
    </div>

    <!-- Section: Result Output -->
    <div id="result-section" class="hidden min-h-screen bg-slate-900 text-white flex flex-col h-screen fixed inset-0 z-[4000]">
        <div class="h-16 bg-slate-800 flex items-center justify-between px-6 border-b border-slate-700 shadow-lg z-20">
            <div class="flex items-center gap-4">
                <div class="bg-slate-700 p-2 rounded-lg"><i class="fa-solid fa-file-code text-green-400 text-xl"></i></div>
                <div>
                    <h3 class="font-bold text-lg leading-none" id="result-title">GAME SPECIFICATION</h3>
                    <p class="text-[10px] text-slate-400 font-mono" id="result-meta">JSON Format</p>
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="copyCode()" class="px-5 py-2 rounded-lg bg-indigo-600 hover:bg-indigo-500 text-sm font-bold transition shadow-lg border border-indigo-400 flex items-center gap-2"><i class="fa-regular fa-copy"></i> Copy JSON</button>
                
                <div id="html-actions" class="flex gap-3">
                    <button onclick="viewTab('code')" id="btn-tab-code" class="px-5 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-sm font-bold transition flex items-center gap-2 border border-blue-600"><i class="fa-solid fa-code"></i> JSON Code</button>
                    <div class="w-[1px] h-8 bg-slate-600 mx-1"></div>
                    <button onclick="viewTab('preview')" id="btn-tab-preview" class="px-5 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm font-bold transition shadow-lg border border-slate-600 flex items-center gap-2"><i class="fa-solid fa-eye"></i> Visual Preview</button>
                    <button onclick="downloadJson()" class="px-5 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-sm font-bold transition shadow-lg border border-emerald-400"><i class="fa-solid fa-download mr-1"></i> Download</button>
                </div>

                <button onclick="closeResult()" class="px-3 py-2 rounded-lg bg-red-600 hover:bg-red-500 text-sm shadow-lg border border-red-400"><i class="fa-solid fa-xmark"></i></button>
            </div>
        </div>

        <div class="flex-1 relative overflow-hidden bg-[#1e1e1e]">
            <!-- Visual Summary Preview -->
            <div id="tab-preview" class="hidden w-full h-full bg-white relative">
                <iframe id="game-preview-frame" class="w-full h-full border-none relative z-10" sandbox="allow-scripts allow-modals allow-same-origin allow-forms allow-popups"></iframe>
            </div>
            
            <!-- Raw Code -->
            <div id="tab-code" class="w-full h-full overflow-auto bg-[#1e1e1e] p-6">
                <pre><code id="generated-code" class="language-json rounded-xl shadow-xl"></code></pre>
            </div>
        </div>
    </div>

    <script>
        // --- DATA & STATE MANAGEMENT ---
        const DB_VERSION = "v1";
        const DEFAULT_USERS = [
            { user: 'admin', pass: 'admin', role: 'admin' },
            { user: 'game', pass: 'beji', role: 'user' }
        ];

        if (!localStorage.getItem('k3s_users')) {
            localStorage.setItem('k3s_users', JSON.stringify(DEFAULT_USERS));
        }
        
        let currentUser = null;
        let generatedContent = "";
        let generatedSpec = null;
        
        // --- AUTH FUNCTIONS ---
        function handleLogin() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            const users = JSON.parse(localStorage.getItem('k3s_users'));
            const found = users.find(x => x.user === u && x.pass === p);
            
            if (found) {
                currentUser = found;
                document.getElementById('login-section').classList.add('hidden');
                if (found.role === 'admin') {
                    renderAdminPanel();
                    document.getElementById('admin-section').classList.remove('hidden');
                } else {
                    document.getElementById('generator-section').classList.remove('hidden');
                    document.getElementById('admin-btn-container').classList.add('hidden');
                }
            } else {
                const err = document.getElementById('login-error');
                err.classList.remove('hidden');
                setTimeout(() => err.classList.add('hidden'), 3000);
            }
        }

        function logout() { location.reload(); }
        
        function goToGenerator() {
            document.getElementById('admin-section').classList.add('hidden');
            document.getElementById('generator-section').classList.remove('hidden');
            if(currentUser && currentUser.role === 'admin') document.getElementById('admin-btn-container').classList.remove('hidden');
        }

        function showAdmin() {
            if(currentUser && currentUser.role === 'admin') {
                document.getElementById('generator-section').classList.add('hidden');
                document.getElementById('admin-section').classList.remove('hidden');
            }
        }

        // --- ADMIN FUNCTIONS ---
        function renderAdminPanel() {
            const users = JSON.parse(localStorage.getItem('k3s_users'));
            const tbody = document.getElementById('user-table-body');
            tbody.innerHTML = '';
            users.forEach((u, index) => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 border-b border-slate-50 transition";
                tr.innerHTML = `
                    <td class="px-4 py-3 font-bold text-slate-700 flex items-center gap-2"><div class="w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-xs"><i class="fa-solid fa-user"></i></div> ${u.user}</td>
                    <td class="px-4 py-3"><span class="${u.role === 'admin' ? 'bg-purple-100 text-purple-700' : 'bg-blue-100 text-blue-700'} px-2 py-1 rounded-md text-xs font-bold uppercase tracking-wider">${u.role}</span></td>
                    <td class="px-4 py-3 text-right">
                        ${u.role !== 'admin' ? `<button onclick="deleteUser(${index})" class="bg-red-50 text-red-500 hover:bg-red-500 hover:text-white w-8 h-8 rounded-lg transition"><i class="fa-solid fa-trash"></i></button>` : '<span class="text-gray-300 text-xs italic">Default</span>'}
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function addUser() {
            const u = document.getElementById('new-user').value;
            const p = document.getElementById('new-pass').value;
            if(!u || !p) return alert("Isi username dan password dengan benar.");
            const users = JSON.parse(localStorage.getItem('k3s_users'));
            users.push({ user: u, pass: p, role: 'user' });
            localStorage.setItem('k3s_users', JSON.stringify(users));
            document.getElementById('new-user').value = '';
            document.getElementById('new-pass').value = '';
            renderAdminPanel();
        }

        function deleteUser(index) {
            if(confirm("Hapus user ini?")) {
                const users = JSON.parse(localStorage.getItem('k3s_users'));
                users.splice(index, 1);
                localStorage.setItem('k3s_users', JSON.stringify(users));
                renderAdminPanel();
            }
        }

        // --- PROMPT GENERATION LOGIC ---
        function generatePromptText(data) {
            // Base Role (English)
            const baseRole = `[Role] You are a senior product designer and full-stack web developer specializing in educational technology for K-12 levels. Think step-by-step and produce a complete and self-contained web application (a single HTML file with CSS + JS inside) suitable for direct use in the "Code" application.`;

            // Logic for IFP Split Screen vs Board Game
            let ifpConstraint = "";
            if (data.deviceMode === 'ifp') {
                if (data.gameModel === 'board') {
                    // Exception for Board/Dice games: Shared view is usually preferred
                    ifpConstraint = "- IFP Layout: Use a SHARED central board view for the map. Player stats (Points/Bars) and controls should be positioned in distinct corners or side panels.";
                } else {
                    // Standard IFP Requirement: Independent Panels
                    ifpConstraint = "- IFP Layout: STRICT SPLIT-SCREEN/GRID layout. Each player MUST have their own dedicated panel. CRITICAL: The Question Container and Score/Point Bar must be rendered INDEPENDENTLY inside each player's panel (not a global modal).";
                }
            } else {
                ifpConstraint = "- Layout: Responsive Mobile-first. Focus on the active player's turn.";
            }

            // Common Constraints (English)
            const commonConstraints = `[Constraints]
- Output: Single index.html file with embedded CSS, JS, and inline SVG assets (in <defs>). No external dependencies.
- Language: Standard Indonesian (interface), child-friendly tone.
- Responsive: Mobile-first, ${data.orientation} orientation, supports IFP & Mobile (${data.deviceMode}).
- Login/Input: ${data.loginInstruction}
- Data: LocalStorage for progress, no ads/tracking.
- Performance: Lightweight (< 300KB).
- Content: Generic themes, no specific IP.
- Question Bank: Minimum ${data.count} questions (${data.cogLevel}) in \`const QUESTION_BANK\`. Random selection logic must be implemented.
- Independent Panels: Each question panel must be self-contained. Score bars/points must update independently on the UI.
${ifpConstraint}
- Timer: Implement a countdown timer of ${data.timer} seconds per question.
- Mandatory Features:
  1. Excel (.xls) download button (Use HTML Table export method with MIME type 'application/vnd.ms-excel', NOT CSV).
  2. ${data.audio ? 'Sound button (TTS or icon) for reading questions.' : 'No audio required.'}
  3. "Finish" confirmation button.
  4. Scoring: Display ${data.scorePoint ? 'Numeric Points' : ''} ${data.scoreBar ? 'and Progress Bar' : ''} in each player's area.
- Win Condition: ${data.winCondition} (Full-screen popup with User Name, Total Points, Stars, and CSS Confetti/Sprinkles).
`;

            // Game Template Switching (English)
            let task = "";
            let context = "";
            let mechanics = "";

            switch(data.gameModel) {
                case 'adventure':
                    task = `[Task] Build an interactive 'RPG Adventure' game for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}. UI Theme: Fantasy, Hero vs Monster.`;
                    mechanics = `[Mechanics]
- Player chooses a hero character.
- Battle a monster in each level by answering questions.
- Correct answer = Attack monster (Monster HP decreases).
- Wrong answer = Player takes damage (Player HP decreases).
- Level Up and XP system.
`;
                    break;
                case 'racing':
                    task = `[Task] Build an interactive 'Car Racing' game for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}. UI Theme: Racing Circuit, Grand Prix.`;
                    mechanics = `[Mechanics]
- Player chooses a Racing Car.
- Race against AI opponents or time.
- Correct answer = Boost Nitro/Speed increases.
- Wrong answer = Car slows down or stalls temporarily.
- Visual track bar showing race position.
`;
                    break;
                case 'board':
                    task = `[Task] Build an interactive 'Board Game Journey' (Snakes & Ladders style) for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}. UI Theme: Adventure Board with 20-50 tiles.`;
                    mechanics = `[Mechanics]
- Player rolls a virtual dice.
- Pawn moves according to dice roll.
- Landing on a "Question Tile" triggers a question modal.
- Correct = Bonus roll or move forward. Wrong = Stay or move backward.
- Special Tiles: Rocket (Fast forward), Black Hole (Move backward).
`;
                    break;
                case 'quizshow':
                    task = `[Task] Build an interactive 'Virtual Quiz Show' game for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}. UI Theme: TV Studio, Podium.`;
                    mechanics = `[Mechanics]
- Host presents a question.
- Fast-paced timer (10-20s).
- Scoring system with multipliers for speed.
- "Lifelines" features (50:50, Ask Audience).
`;
                    break;
                case 'memory':
                    task = `[Task] Build an interactive 'Memory Card Match' game for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}. UI Theme: Card Grid.`;
                    mechanics = `[Mechanics]
- Grid of cards (e.g., 4x4 or 6x6).
- Match pairs: [Question] with [Answer], or [Image] with [Concept Name].
- Wrong match = Cards flip back.
- Correct match = Cards stay open + Points.
`;
                    break;
                case 'balloon':
                    task = `[Task] Build an interactive 'Balloon Pop Challenge' game for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}. UI Theme: Blue Sky, Colorful Balloons.`;
                    mechanics = `[Mechanics]
- Questions appear at the bottom panel.
- Balloons containing answer options float up from the bottom.
- Player must click/tap the balloon with the CORRECT answer before it flies away.
- Wrong click = Points deduction.
`;
                    break;
                case 'wordsearch':
                    task = `[Task] Build an interactive 'Word Search Puzzle' game for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}. UI Theme: Letter Grid.`;
                    mechanics = `[Mechanics]
- Side panel displays questions/clues.
- Player finds the answer word hidden in the letter grid (Horizontal, Vertical, Diagonal).
- Drag/Swipe to highlight words.
`;
                    break;
                case 'shooter':
                    task = `[Task] Build an interactive 'Space Mission Shooter' game for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}. UI Theme: Space, Spaceship.`;
                    mechanics = `[Mechanics]
- Player controls a spaceship (left-right movement).
- Enemies/Asteroids descend carrying answer options.
- Shoot the enemy carrying the CORRECT answer.
- Avoid shooting wrong answers.
`;
                    break;
                case 'farming':
                    task = `[Task] Build an interactive 'Smart Garden Farming' game for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}. UI Theme: Farm, Plants.`;
                    mechanics = `[Mechanics]
- Plants need water/fertilizer to grow.
- Correct answer = Water/Fertilize -> Plant grows to next stage.
- Wrong answer = Pests attack/Plant withers.
- Goal: Full harvest.
`;
                    break;
                case 'mystery':
                    task = `[Task] Build an interactive 'Detective Mystery' game for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}. UI Theme: Detective Office, Case Board.`;
                    mechanics = `[Mechanics]
- A main mystery case to solve.
- Each correct answer unlocks a new Clue/Evidence.
- Collect all evidence to identify the suspect/solution at the end.
`;
                    break;
                default:
                    task = `[Task] Build an interactive 'Standard Quiz' game for [Subject: ${data.subject}] for [Grade: ${data.grade}] covering the topic: ${data.material}.`;
                    context = `[Context] Audience: Students of ${data.grade}. Objective: ${data.objective}.`;
                    mechanics = `[Mechanics] Standard multiple-choice quiz with points and levels.`;
            }

            // Assemble Full Prompt
            return `${baseRole}\n\n${task}\n\n${context}\n\n${mechanics}\n\n${commonConstraints}`;
        }

        // --- MAIN GENERATION HANDLER ---
        function startGeneration() {
            // 1. Collect Form Data
            const appName = document.getElementById('gen-app-name').value || "Game Edukasi";
            const subject = (document.querySelector('input[name="subject_select"]:checked') || {}).value || "Umum";
            const gradeVal = document.querySelector('input[name="grade"]:checked').value;
            const objective = document.getElementById('gen-objective').value || "-";
            const material = document.getElementById('gen-material').value || "-";
            const cogLevel = (document.querySelector('input[name="cog_level"]:checked') || {}).value || "MOTS";
            const footerText = document.getElementById('gen-footer').value;
            
            // Config
            const gameModel = document.querySelector('input[name="game_model"]:checked').value;
            const deviceMode = document.querySelector('input[name="device_mode"]:checked').value;
            const orientation = document.querySelector('input[name="orientation"]:checked').value;
            const scorePoint = document.getElementById('conf-score-point').checked;
            const scoreBar = document.getElementById('conf-score-bar').checked;
            const players = parseInt(document.getElementById('gen-players').value) || 1;
            const questionCount = parseInt(document.getElementById('gen-count').value) || 10;
            const audioEnabled = document.getElementById('audio-toggle').checked;
            const timerVal = document.getElementById('gen-timer').value || 10;

            // 2. Logic for Instructions
            let loginInstructions = "";
            if (players === 1) {
                loginInstructions = "Single Player. Display a name input at the start. Save name for final certificate.";
            } else {
                loginInstructions = `Multiplayer (${players} Players). Display ${players} separate name inputs at the start (Player 1 to ${players}). Ensure clearly defined turn-based UI or split-screen if possible on ${deviceMode}.`;
            }

            const winCondition = "If User Wins: Show a full-screen Modal Popup. Content: User Name, Total Final Score, Stars, and festive CSS Confetti/Sprinkles animation.";

            const data = {
                appName, subject, grade: `Kelas ${gradeVal} SD`, objective, material, cogLevel, footerText,
                gameModel, deviceMode, orientation, scorePoint, scoreBar, players, count: questionCount, audio: audioEnabled,
                timer: timerVal, loginInstruction: loginInstructions, winCondition
            };

            // 3. Generate Content
            const promptText = generatePromptText(data);
            
            // Construct JSON Output
            const outputJson = {
                "meta": {
                    "generator": "K3S BEJI Game Creator V5",
                    "timestamp": new Date().toISOString(),
                    "app_title": appName
                },
                "game_config": {
                    "template": gameModel,
                    "target": `${subject} - Kelas ${gradeVal}`,
                    "mode": deviceMode,
                    "players": players,
                    "timer": `${timerVal}s`
                },
                "prompt_content": promptText
            };
            
            generatedSpec = outputJson; // Store object for preview
            const jsonString = JSON.stringify(outputJson, null, 4);

            // 4. Show Result
            document.getElementById('loading-modal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('loading-modal').classList.add('hidden');
                displayResult(jsonString, data);
            }, 800);
        }

        // --- RESULT DISPLAY ---
        function displayResult(content, data) {
            generatedContent = content;
            document.getElementById('generator-section').classList.add('hidden');
            document.getElementById('result-section').classList.remove('hidden');
            
            const codeBlock = document.getElementById('generated-code');
            const frame = document.getElementById('game-preview-frame');

            codeBlock.textContent = content;
            hljs.highlightElement(codeBlock);

            // Visual Summary HTML
            const summaryHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                    <style>body{font-family:sans-serif;}</style>
                </head>
                <body class="bg-slate-50 p-6">
                    <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg border border-slate-200 overflow-hidden">
                        <div class="bg-gradient-to-r from-indigo-600 to-purple-600 p-5 text-white">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h1 class="text-xl font-bold">${data.appName}</h1>
                                    <p class="text-xs opacity-80 mt-1 uppercase tracking-wide">Specification Summary</p>
                                </div>
                                <div class="bg-white/20 px-3 py-1 rounded-full text-xs font-bold">
                                    ${data.gameModel.toUpperCase()}
                                </div>
                            </div>
                        </div>
                        <div class="p-6 space-y-4">
                            <div class="flex gap-4 border-b border-slate-100 pb-4">
                                <div class="w-1/2">
                                    <label class="text-[10px] font-bold text-slate-400 uppercase">Subject</label>
                                    <p class="font-bold text-slate-700">${data.subject}</p>
                                </div>
                                <div class="w-1/2">
                                    <label class="text-[10px] font-bold text-slate-400 uppercase">Grade</label>
                                    <p class="font-bold text-slate-700">${data.grade}</p>
                                </div>
                            </div>
                            
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Instructions Logic</label>
                                <div class="bg-blue-50 p-3 rounded-lg border border-blue-100 mt-1">
                                    <p class="text-xs text-blue-800 font-medium leading-relaxed">
                                        <i class="fa-solid fa-users mr-1"></i> ${data.loginInstruction}
                                    </p>
                                </div>
                            </div>

                             <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase">Win Condition</label>
                                <div class="bg-green-50 p-3 rounded-lg border border-green-100 mt-1">
                                    <p class="text-xs text-green-800 font-medium leading-relaxed">
                                        <i class="fa-solid fa-trophy mr-1"></i> ${data.winCondition}
                                    </p>
                                </div>
                            </div>

                            <div class="grid grid-cols-3 gap-3 pt-2">
                                <div class="bg-slate-50 p-2 rounded border border-slate-100 text-center">
                                    <span class="block text-xs text-slate-400 font-bold">Orientation</span>
                                    <span class="text-sm font-bold text-slate-700 capitalize">${data.orientation}</span>
                                </div>
                                <div class="bg-slate-50 p-2 rounded border border-slate-100 text-center">
                                    <span class="block text-xs text-slate-400 font-bold">Timer</span>
                                    <span class="text-sm font-bold text-slate-700">${data.timer}s</span>
                                </div>
                                <div class="bg-slate-50 p-2 rounded border border-slate-100 text-center">
                                    <span class="block text-xs text-slate-400 font-bold">Question Count</span>
                                    <span class="text-sm font-bold text-slate-700">${data.count} Items</span>
                                </div>
                            </div>
                        </div>
                         <div class="bg-slate-100 p-3 text-center">
                            <p class="text-[10px] text-slate-500">Copy the JSON code to generate this game.</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            const blob = new Blob([summaryHtml], { type: 'text/html' });
            frame.src = URL.createObjectURL(blob);

            // Default to Code view
            viewTab('code');
        }

        function viewTab(tab) {
            const btnPreview = document.getElementById('btn-tab-preview');
            const btnCode = document.getElementById('btn-tab-code');
            
            if (tab === 'preview') {
                document.getElementById('tab-preview').classList.remove('hidden');
                document.getElementById('tab-code').classList.add('hidden');
                
                // Set Active
                btnPreview.classList.remove('bg-slate-700', 'border-slate-600'); 
                btnPreview.classList.add('bg-blue-600', 'border-blue-400');
                
                btnCode.classList.remove('bg-blue-600', 'border-blue-600'); 
                btnCode.classList.add('bg-slate-700', 'border-slate-600');

            } else {
                document.getElementById('tab-preview').classList.add('hidden');
                document.getElementById('tab-code').classList.remove('hidden');
                
                // Set Active
                btnCode.classList.remove('bg-slate-700', 'border-slate-600'); 
                btnCode.classList.add('bg-blue-600', 'border-blue-600');
                
                btnPreview.classList.remove('bg-blue-600', 'border-blue-400'); 
                btnPreview.classList.add('bg-slate-700', 'border-slate-600');
            }
        }

        function downloadJson() {
            const blob = new Blob([generatedContent], { type: "application/json" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `game-prompt-${Date.now()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function copyCode() {
            navigator.clipboard.writeText(generatedContent).then(() => {
                alert("Kode JSON berhasil disalin ke clipboard!");
            }).catch(err => {
                console.error('Gagal menyalin: ', err);
            });
        }

        function closeResult() {
            document.getElementById('result-section').classList.add('hidden');
            document.getElementById('generator-section').classList.remove('hidden');
        }
    </script>
</body>
</html>


